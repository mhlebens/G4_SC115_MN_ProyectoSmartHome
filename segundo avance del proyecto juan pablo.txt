import json

usuarios = []  # almacenamiento en memoria

# cargar los usuarios desde un archivo al inicio
try:
    with open("usuarios.txt", "r") as archivo:
        usuarios = json.load(archivo)
except FileNotFoundError:
    pass  # Si el archivo no existe, simplemente seguimos con la lista vacía

def registro():
    nombre = input("Ingrese su nombre: ")
    correo = input("Ingrese su correo electrónico: ")
    pin = input("Ingrese su pin: ")
    
    print("Su nombre de la cuenta es:", nombre)
    print("Su correo electrónico es:", correo)
    print("Su pin es:", pin)
    
    return nombre, correo, pin

def registrar_usuario(usuarios):
    nombre, correo, pin = registro()

    # ver si hay registro 
    if any(usuario['nombre'] == nombre or usuario['correo'] == correo for usuario in usuarios):
        print("El usuario ya está registrado.")
    else:
        usuarios.append({'nombre': nombre, 'correo': correo, 'pin': pin})
        with open("usuarios.txt", "w") as archivo:  # guardar los usuarios en el archivo
            json.dump(usuarios, archivo)
        print("Usuario registrado con éxito.")

#loggeo
def iniciar_sesion(usuarios):
    nombre = input("Nombre: ")
    pin = input("PIN: ")

    #verificar si las credenciales coinciden con las que se hicieron
    for usuario in usuarios:
        if usuario['nombre'] == nombre and usuario['pin'] == pin:
            print("Inicio de sesión exitoso.")
            return True
        
    print("Nombre o PIN incorrecto.")
    return False

def menu_principal():
    while True:
        print("Menú Principal")
        print("1. Registrar usuario")
        print("2. Iniciar sesión")
        print("3. Salir")
        
        opcion = input("Seleccione una opción: ")

        if opcion == '1':
            registrar_usuario(usuarios)
        elif opcion == '2':
            if not iniciar_sesion(usuarios):
                print("Desea intentar de nuevo o registrar un nuevo usuario.")
                continuar = input("Ingrese 1 para volver a intentar o 2 para registrar un nuevo usuario: ")
                if continuar == '2':
                    registrar_usuario(usuarios)
                elif continuar == '1':
                    continue
                else:
                    print("Opción no válida.")
        elif opcion == '3':
            print("Saliendo del sistema.")
            break
        else:
            print("Opción no válida. Inténtelo de nuevo.")

menu_principal()
